(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[923],{1790:function(e,t,r){Promise.resolve().then(r.bind(r,841))},841:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return L}});var a=r(7437),n=r(2265),o=r(8929),c=r(3719),l=r(5519),s=r(8539),i=r(5349),u=r(7999),d=r(270),h=r(5786),g=r(7318),v=r(6645),m=r(8884),f=r(8367),p=r(4691),x=r(1793),w=r(2853);function S(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],[t,r]=n.useState(new Set);n.useEffect(()=>{r(new Set)},[e]);let a=n.useCallback(()=>{r(new Set)},[]),o=n.useCallback(e=>{r(t=>{let r=new Set(t);return r.delete(e),r})},[]),c=n.useCallback(()=>{r(new Set(e))},[e]),l=n.useCallback(e=>{r(t=>{let r=new Set(t);return r.add(e),console.log("Добавлено:",e,"Текущий выбор:",r),r})},[]),s=t.size>0,i=t.size===e.length;return{deselectAll:a,deselectOne:o,selectAll:c,selectOne:l,selected:t,selectedAny:s,selectedAll:i}}var E=r(6463);function k(){}function y(e){var t,r;let{count:l=0,rows:s=[],page:y=0,rowsPerPage:j=0,onSelectionChange:Z}=e,{selectAll:A,deselectAll:b,selectOne:I,deselectOne:C,selected:R}=S(n.useMemo(()=>s.map(e=>e.id),[s])),[z,L]=(0,n.useState)(!0),[U,N]=(0,n.useState)(null);(0,E.useRouter)();let P=(null!==(t=null==R?void 0:R.size)&&void 0!==t?t:0)>0&&(null!==(r=null==R?void 0:R.size)&&void 0!==r?r:0)<s.length,W=s.length>0&&(null==R?void 0:R.size)===s.length;return(0,n.useEffect)(()=>{Z&&Z(R)},[R,Z]),(0,a.jsxs)(d.Z,{children:[(0,a.jsx)(u.Z,{sx:{overflowX:"auto"},children:(0,a.jsxs)(v.Z,{sx:{minWidth:"800px"},children:[(0,a.jsx)(p.Z,{children:(0,a.jsxs)(w.Z,{children:[(0,a.jsx)(f.Z,{padding:"checkbox",children:(0,a.jsx)(h.Z,{checked:W,indeterminate:P,onChange:e=>{e.target.checked?A():b()}})}),(0,a.jsx)(f.Z,{children:"Организатор"}),(0,a.jsx)(f.Z,{children:"Название"}),(0,a.jsx)(f.Z,{children:"Описание"})]})}),(0,a.jsx)(m.Z,{children:s.map(e=>{let t=null==R?void 0:R.has(e.id);return(0,a.jsxs)(w.Z,{hover:!0,selected:t,children:[(0,a.jsx)(f.Z,{padding:"checkbox",children:(0,a.jsx)(h.Z,{checked:t,onChange:t=>{t.target.checked?I(e.id):C(e.id)}})}),(0,a.jsx)(f.Z,{children:(0,a.jsxs)(o.Z,{sx:{alignItems:"center"},direction:"row",spacing:2,children:[(0,a.jsx)(i.Z,{src:e.organizer.avatar}),(0,a.jsxs)(c.Z,{variant:"subtitle2",children:[e.organizer.firstName," ",e.organizer.lastName]})]})}),(0,a.jsx)(f.Z,{children:e.title}),(0,a.jsx)(f.Z,{children:e.description})]},e.id)})})]})}),(0,a.jsx)(g.Z,{}),(0,a.jsx)(x.Z,{component:"div",count:l,onPageChange:k,onRowsPerPageChange:k,page:y,rowsPerPage:j,rowsPerPageOptions:[5,10,25]})]})}var j=r(4431),Z=r(3814),A=r(7905),b=r(6858),I=r(760),C=r(2494),R=e=>{let{isOpen:t,onClose:r,onEventCreated:s,userId:i,tag:d}=e,[h,g]=(0,n.useState)(""),[v,m]=(0,n.useState)(""),[f,p]=(0,n.useState)(""),[x,w]=(0,n.useState)(""),[S,E]=(0,n.useState)(""),[k,y]=(0,n.useState)(!1),[j,R]=(0,n.useState)(null),[z,L]=(0,n.useState)(null),U=async()=>{if(i&&null!==z){y(!0),R(null);try{let{error:e}=await Z.U.createEvent({title:h,description:f,start:x,end:S,userId:i,location_address:v,tag:z});e?R("Не удалось создать событие"):(r(),s())}catch(e){R("Произошла ошибка при создании события")}finally{y(!1)}}};return(0,a.jsx)(A.Z,{open:t,onClose:r,children:(0,a.jsx)(u.Z,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",borderRadius:1,boxShadow:24,p:4},children:(0,a.jsxs)(o.Z,{spacing:2,children:[(0,a.jsx)(c.Z,{variant:"h6",children:"Создать мероприятие"}),j&&(0,a.jsx)(c.Z,{color:"error",children:j}),(0,a.jsx)(b.Z,{label:"Заголовок",value:h,onChange:e=>g(e.target.value),fullWidth:!0}),(0,a.jsx)(b.Z,{label:"Описание",value:f,onChange:e=>p(e.target.value),fullWidth:!0}),(0,a.jsx)(b.Z,{label:"Локация",value:v,onChange:e=>m(e.target.value),fullWidth:!0}),(0,a.jsx)(b.Z,{label:"Время начала",type:"datetime-local",value:x,onChange:e=>w(e.target.value),fullWidth:!0,InputLabelProps:{shrink:!0}}),(0,a.jsx)(b.Z,{label:"Время окончания",type:"datetime-local",value:S,onChange:e=>E(e.target.value),fullWidth:!0,InputLabelProps:{shrink:!0}}),(0,a.jsx)(I.Z,{label:"Выберите событие",value:z||"",onChange:e=>L(e.target.value),fullWidth:!0,children:d.map(e=>(0,a.jsx)(C.Z,{value:e.id,children:e.name},e.id))}),(0,a.jsxs)(o.Z,{direction:"row",spacing:1,justifyContent:"flex-end",children:[(0,a.jsx)(l.Z,{variant:"contained",onClick:U,disabled:k,children:"Создать"}),(0,a.jsx)(l.Z,{variant:"outlined",onClick:r,children:"Отмена"})]})]})})})},z=r(3141);function L(){let[e,t]=(0,n.useState)([]),[r,i]=(0,n.useState)(!0),[u,d]=(0,n.useState)(null),[h,g]=(0,n.useState)(""),[v,m]=(0,n.useState)(""),[f,p]=(0,n.useState)(!1),[x,w]=(0,n.useState)(new Set);(0,E.useRouter)();let{selected:k}=S(n.useMemo(()=>e.map(e=>e.id),[e]));(0,n.useEffect)(()=>{async function e(){let{data:e,error:t}=await Z.U.getUser();e&&(g(e.id),m(e.status))}document.title="Events | Dashboard | ".concat(z.v.site.name),async function(){i(!0);let{data:e,error:r}=await Z.U.getMyEvent();if(r){d("Не удалось загрузить события"),i(!1);return}t(e||[]),i(!1)}(),e()},[]);let A=async()=>{i(!0);let{data:e,error:r}=await Z.U.getMyEvent();e&&t(e),i(!1)},b=async()=>{let r=Array.from(x).map(t=>{let r=e.find(e=>e.id===t);return r?r.eventId:null}).filter(e=>null!==e);if(r.length>0){let{data:e,error:a}=await Z.U.deleteEvent(r);a?console.error("Ошибка при удалении событий:",a):(t(e=>e.filter(e=>!r.includes(e.eventId))),console.log("События успешно удалены:",e))}else console.log("Нет выбранных событий для удаления")};return(0,a.jsxs)(o.Z,{spacing:3,children:[(0,a.jsxs)(o.Z,{direction:"row",spacing:3,children:[(0,a.jsxs)(o.Z,{spacing:1,sx:{flex:"1 1 auto"},children:[(0,a.jsx)(c.Z,{variant:"h4",children:"События"}),"GUEST"!==v&&(0,a.jsx)(o.Z,{direction:"row",spacing:1,sx:{alignItems:"center"},children:(0,a.jsx)(l.Z,{color:"inherit",startIcon:(0,a.jsx)(s.r,{fontSize:"var(--icon-fontSize-md)"}),onClick:()=>{w(new Set(k)),console.log("Кнопка удаления нажата. Выбранные события:",k),b()},children:"Удалить"})})]}),"GUEST"!==v&&(0,a.jsx)("div",{children:(0,a.jsx)(l.Z,{startIcon:(0,a.jsx)(j.v,{fontSize:"var(--icon-fontSize-md)"}),variant:"contained",onClick:()=>p(!0),sx:{backgroundColor:"#1b3a69","&:hover":{backgroundColor:"#0f1e3c"}},children:"Создать"})})]}),!r&&!u&&(0,a.jsx)(y,{count:e.length,page:0,rows:e,rowsPerPage:5,onSelectionChange:e=>{w(e),console.log("Изменение выбора в родительском компоненте:",e)}}),r&&(0,a.jsx)(c.Z,{children:"Загрузка..."}),u&&(0,a.jsx)(c.Z,{color:"error",children:u}),(0,a.jsx)(R,{isOpen:f,onClose:()=>p(!1),onEventCreated:A,userId:h,tag:[{id:"8",name:"Инвест-клуб"},{id:"3",name:"Маркетплейсы"},{id:"7",name:"Спорт-клуб"},{id:"1",name:"Читай-клуб"},{id:"5",name:"Благотворительность"},{id:"2",name:"Английский разговорный клуб"},{id:"6",name:"Производство"},{id:"4",name:"Родительский совет"}]})]})}},3141:function(e,t,r){"use strict";let a;r.d(t,{v:function(){return u}});var n,o,c,l=r(357),s=r(8473),i=r(357);let u={site:{name:"Krona События",description:"",themeColor:"#090a0b",url:a=(a=(a=null!==(o=null!==(n=l.env.NEXT_PUBLIC_SITE_URL)&&void 0!==n?n:l.env.NEXT_PUBLIC_VERCEL_URL)&&void 0!==o?o:"http://localhost:3000/").includes("http")?a:"https://".concat(a)).endsWith("/")?a:"".concat(a,"/")},logLevel:null!==(c=i.env.NEXT_PUBLIC_LOG_LEVEL)&&void 0!==c?c:s.in.ALL}},3814:function(e,t,r){"use strict";r.d(t,{U:function(){return l}});var a=r(8472);let n=a.Z.create({baseURL:"http://37.194.168.90:2100"}),o=a.Z.create({baseURL:"http://37.194.168.90:2000"});n.interceptors.request.use(e=>(console.log("Starting Request: ",e),e));class c{async signUp(e){let{email:t,password:r,firstName:o,lastName:c}=e;try{return await n.post("auth/signup",{email:t,password:r,firstName:o,lastName:c,headers:{Authorization:"".concat(localStorage.getItem("custom-auth-token"))}}),{}}catch(e){if(a.Z.isAxiosError(e)){var l;return{error:(null===(l=e.response)||void 0===l?void 0:l.data)||"An error occurred"}}return{error:"An unknown error occurred"}}}async signInWithOAuth(e){return{error:"Social authentication not implemented"}}async signInWithPassword(e){let{email:t,password:r}=e;try{let e=await n.post("auth/signin",{email:t,password:r,headers:{Authorization:"".concat(localStorage.getItem("custom-auth-token"))}}),{token:a}=e.data,{token_name:o}=e.data;return console.log(o,a),a&&o&&localStorage.setItem(o,a),{}}catch(e){if(a.Z.isAxiosError(e)){var o;return{error:(null===(o=e.response)||void 0===o?void 0:o.data)||"An error occurred"}}return{error:"An unknown error occurred"}}}async resetPassword(e){return{error:"Password reset not implemented"}}async updatePassword(e){return{error:"Update reset not implemented"}}async getUser(){try{let e=localStorage.getItem("custom-auth-token");console.log("token = "+e);let t=await n.get("account/getinfo",{headers:{Authorization:"".concat(e)}});if(!t.data)return{data:null};return{data:t.data}}catch(e){return{data:null}}}async createEvent(e){try{return{data:(await n.post("events/create",e,{headers:{Authorization:"".concat(localStorage.getItem("custom-auth-token"))}})).data}}catch(e){return console.error("Error creating event:",e),{error:"Failed to create event"}}}async saveTags(e){console.log(e);try{return{data:(await n.post("account/tags",e,{headers:{Authorization:"".concat(localStorage.getItem("custom-auth-token"))}})).data}}catch(e){return console.error("Error creating event:",e),{error:"Failed to create event"}}}async getEventsCount(){try{let e=localStorage.getItem("custom-auth-token");console.log("token = "+e);let t=await n.get("events/count",{headers:{Authorization:"".concat(e)}});if(!t.data)return{data:null};return{data:t.data}}catch(e){return{data:null}}}async getMyEvent(){try{return console.log(localStorage.getItem("custom-auth-token")),{data:(await n.post("events/getall",null,{headers:{Authorization:"".concat(localStorage.getItem("custom-auth-token"))}})).data}}catch(e){return console.error("Error fetching event:",e),{error:"Failed to fetch event"}}}async deleteEvent(e){try{return{data:(await n.post("events/delete",e,{headers:{Authorization:"".concat(localStorage.getItem("custom-auth-token"))}})).data}}catch(e){return console.error("Error deleting events:",e),{error:"Failed to delete events"}}}async uploadAvatar(e){let t=new FormData;t.append("file",e),console.log("formData");try{let[e,r]=(await n.post("account/savefile",t,{headers:{Authorization:"".concat(localStorage.getItem("custom-auth-token"))}})).data;return{url:r}}catch(e){return{error:"Error uploading avatar"}}}async getCalendar(){try{return{data:(await n.get("calendar/get",{headers:{Authorization:"".concat(localStorage.getItem("custom-auth-token"))}})).data}}catch(e){return{error:"Error signing out"}}}async signOut(){try{return await n.get("account/logout",{headers:{Authorization:"".concat(localStorage.getItem("custom-auth-token"))}}),document.cookie="custom-auth-token=; path=/; max-age=0;",{}}catch(e){return{error:"Error signing out"}}}async callback(){try{console.log("callback");let e=new URLSearchParams(window.location.search).get("code");return await o.get("/callback",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("custom-auth-token"))},params:{code:e}}),{}}catch(e){return console.error("Error occurred:",e),{error:"Error during the start of monitoring"}}}async hhStatus(){try{return(await o.get("monitoring/status",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("custom-auth-token"))}})).data}catch(e){return console.error("Error occurred:",e),!1}}async hhStart(){try{let e=await o.get("monitoring/start",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("custom-auth-token"))}});if(202===e.status){let t=e.data;t&&(window.location.href=t)}return{error:e.data||"No data from server"}}catch(e){return console.error("Error occurred:",e),{error:"Error during the start of monitoring"}}}async hhStop(){try{return await o.get("monitoring/stop",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("custom-auth-token"))}}),document.cookie="custom-auth-token=; path=/; max-age=0;",{}}catch(e){return{error:"Error signing out"}}}async signUpToken(e){try{let t=await n.post("auth/confirm",{check_token:e},{headers:{Authorization:"".concat(localStorage.getItem("custom-auth-token"))}}),{token:r}=t.data,{token_name:a}=t.data;return console.log(a,r),r&&a&&localStorage.setItem(a,r),{}}catch(e){if(a.Z.isAxiosError(e)){var t;return{error:(null===(t=e.response)||void 0===t?void 0:t.data)||"An error occurred"}}return{error:"An unknown error occurred"}}}async subscribe(e){try{console.log("eventId = "+e);let t=await n.post("events/subscribe",{eventId:e},{headers:{Authorization:"".concat(localStorage.getItem("custom-auth-token"))}}),{token:r}=t.data,{token_name:a}=t.data;return console.log(a,r),r&&a&&localStorage.setItem(a,r),{}}catch(e){if(a.Z.isAxiosError(e)){var t;return{error:(null===(t=e.response)||void 0===t?void 0:t.data)||"An error occurred"}}return{error:"An unknown error occurred"}}}}let l=new c},8473:function(e,t,r){"use strict";r.d(t,{hu:function(){return c},in:function(){return a}});let a={NONE:"NONE",ERROR:"ERROR",WARN:"WARN",DEBUG:"DEBUG",ALL:"ALL"},n={NONE:0,ERROR:1,WARN:2,DEBUG:3,ALL:4};class o{canWrite(e){return this.levelNumber>=n[e]}write(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];let o=this.prefix;this.showLevel&&(o="- ".concat(e," ").concat(o)),e===a.ERROR?console.error(o,...r):console.log(o,...r)}constructor({prefix:e="",level:t=a.ALL,showLevel:r=!0}){var o=this;this.debug=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];o.canWrite(a.DEBUG)&&o.write(a.DEBUG,...t)},this.warn=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];o.canWrite(a.WARN)&&o.write(a.WARN,...t)},this.error=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];o.canWrite(a.ERROR)&&o.write(a.ERROR,...t)},this.prefix=e,this.level=t,this.levelNumber=n[this.level],this.showLevel=r}}function c(){let{prefix:e,level:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new o({prefix:e,level:t})}}},function(e){e.O(0,[342,919,472,125,907,296,786,564,687,727,971,23,744],function(){return e(e.s=1790)}),_N_E=e.O()}]);